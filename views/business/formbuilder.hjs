<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
</head>

<body>
    <fieldset id="buildyourform"></fieldset>
    <input type="button" value="Preview form" class="add" id="preview" />
    <input type="button" value="Add a field" class="add" id="add" />
    <input type="button" value="Submit" class="add" id="submit" />
    <script src="/javascripts/lib/jquery/jquery-2.1.3.min.js"></script> 

    <script type="text/javascript">

        var fieldSet = $("<fieldset><legend>Your Form</legend></fieldset>");
        var json = [];

        function insert() {
            var x = document.getElementById("mySelect");
            var option = document.createElement("option");
            option.text = prompt ("Name your option");
            x.add(option);
        }
        function removeOption() {
            var x = document.getElementById("mySelect");
            x.remove(x.selectedIndex);
        }

        $(document).ready(function () {
            $("#add").click(function () {
                var intId = $("#buildyourform div").length + 1;
                var fieldWrapper = $("<div class=\"fieldwrapper\" id=\"field" + intId + "\"/>");
                var fName = $("<input type=\"text\" class=\"fieldname\" />");
                var fType = $("<select class=\"fieldtype\"><option value=\"textbox\">Text</option> class=\"fieldtype\"><option value=\"dropdown\">Drop</option> </select>");
                
                var removeButton = $("<input type=\"button\" class=\"remove\" value=Remove>");
                removeButton.click(function () {
                    $(this).parent().remove();
                });
                fieldWrapper.append(fName);
                fieldWrapper.append(fType);
                fieldWrapper.append(removeButton);
                $("#buildyourform").append(fieldWrapper);
            });
            $("#preview").click(function () {
                $("#yourform").remove();
                $("#buildyourform div").each(function () {
                    var id = "input" + $(this).attr("id").replace("field", "");
                    var label = $("<label for=\"" + id + "\">" + $(this).find("input.fieldname").first().val() + "</label>");
                    var input;
                    switch ($(this).find("select.fieldtype").first().val()) {
                        case "textbox":
                            input = $("<div><input type=\"text\" id=\"" + id + "\" name=\"" + id + "\" /></div>");
                            break;
                        case "dropdown":
                            input = $("<div><select id=\"mySelect\">  </select> <button type=\"button\" onclick=\"insert()\">Insert option</button> <button type=\"button\" onclick=\"removeOption()\">Remove option</button></div>");
                            break;
                    } 
                    fieldSet.append(label);
                    fieldSet.append(input);
                });
                $("body").append(fieldSet);
            });

            $("#submit").click(function() {
                console.log(fieldSet.prop('outerHTML'));

                var form = $("fieldset");
                var json = [];
                form.children().each(function(i, elem){
                    if ($(this).find("select.fieldtype").first().val()) { 
                        if ($(this).find("select.fieldtype").first().val() == 'dropdown') {
                            json.push('dropdown');
                            json.push($(this).find("input.fieldname").first().val());

                            var options = $('#mySelect option');
                            var values = $.map(options ,function(option) {
                                json.push(option.value);
                            });
                        }
                        else {
                            json.push('textbox');
                            json.push($(this).find("input.fieldname").first().val());
                        }

                    }
                })
                console.log(json);
            })
});
    </script>
</body>

</html>






